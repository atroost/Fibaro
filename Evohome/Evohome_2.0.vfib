{"name":"Evohome 2.0","type":"virtual_device","properties":{"deviceIcon":1002,"categories":"[\"climate\"]","currentIcon":"1001","log":"","logTemp":"","mainLoop":"local selfId = fibaro:getSelfId();\nlocal TimeOfDay = fibaro:getGlobal(\"TimeOfDay\");\nfibaro:call(selfId, \"pressButton\", \"9\");\nif (TimeOfDay == \"night\") then\n  -- Wait 60 minutes:\n  fibaro:sleep(60*60*1000)\nelse\n  -- Wait 15 minutes:\n  fibaro:sleep(15*60*1000)\nend","ui.lblError.value":"","ui.lblOverview.value":"Woonkamer: 24.5 (21) °C <br />Keuken: 24.5 (15) °C <br />Kantoor: 22.5 (18) °C <br />Master: 22 (10) °C <br />Jord: 24.5 (10) °C <br />Kris: 25 (10) °C <br />Hal: 22.5 (10) °C <br />Badkamer: 25.5 (15) °C <br />","ui.lblQuickActions.value":"Auto","ui.lblStatus.value":"OK","ui.lbllastUpdate.value":"Mon Aug 12 20:25:52 2019","visible":"true","rows":[{"type":"label","elements":[{"id":1,"lua":false,"waitForResponse":false,"caption":"Quick Actions","name":"lblQuickActions","favourite":false,"main":true}]},{"type":"button","elements":[{"id":2,"lua":true,"waitForResponse":false,"caption":"Auto","name":"btnQAAuto","empty":false,"msg":"local selfId = fibaro:getSelfId();\nlocal locationID = fibaro:get(selfId, 'IPAddress');\nlocal sceneID = fibaro:get(selfId, 'TCPPort');\n\n---fibaro:setGlobal(\"EvohomeAPI\", \"mode,Auto,\"..locationID..\",,,\")\n---fibaro:sleep(2000)\nfibaro:startScene(sceneID,{\"mode\",\"Auto\",locationID,\"\",\"\",\"\"})","buttonIcon":1001,"favourite":false,"main":false},{"id":3,"lua":true,"waitForResponse":false,"caption":"Eco","name":"btnQAEco","empty":false,"msg":"local selfId = fibaro:getSelfId();\nlocal locationID = fibaro:get(selfId, 'IPAddress');\nlocal sceneID = fibaro:get(selfId, 'TCPPort');\n\n---fibaro:setGlobal(\"EvohomeAPI\", \"mode,AutoWithEco,\"..locationID..\",,,\")\n---fibaro:sleep(2000)\nfibaro:startScene(sceneID, {\"mode\",\"AutoWithEco\",locationID,\"\",\"\",\"\"})","buttonIcon":1006,"favourite":false,"main":false}]},{"type":"button","elements":[{"id":4,"lua":true,"waitForResponse":false,"caption":"Away","name":"btnQAAway","empty":false,"msg":"local selfId = fibaro:getSelfId();\nlocal locationID = fibaro:get(selfId, 'IPAddress');\nlocal sceneID = fibaro:get(selfId, 'TCPPort');\n\n---fibaro:setGlobal(\"EvohomeAPI\", \"mode,Away,\"..locationID..\",,,\")\n---fibaro:sleep(2000)\nfibaro:startScene(sceneID, {\"mode\",\"Away\",locationID,\"\",\"\",\"\"})","buttonIcon":1002,"favourite":false,"main":false},{"id":5,"lua":true,"waitForResponse":false,"caption":"Day off","name":"btnQADayoff","empty":false,"msg":"local selfId = fibaro:getSelfId();\nlocal locationID = fibaro:get(selfId, 'IPAddress');\nlocal sceneID = fibaro:get(selfId, 'TCPPort');\n\n---fibaro:setGlobal(\"EvohomeAPI\", \"mode,DayOff,\"..locationID..\",,,\")\n---fibaro:sleep(2000)\nfibaro:startScene(sceneID, {\"mode\",\"DayOff\",locationID,\"\",\"\",\"\"})","buttonIcon":1004,"favourite":false,"main":false}]},{"type":"button","elements":[{"id":6,"lua":true,"waitForResponse":false,"caption":"Heating off","name":"btnQAHeatingoff","empty":false,"msg":"local selfId = fibaro:getSelfId();\nlocal locationID = fibaro:get(selfId, 'IPAddress');\nlocal sceneID = fibaro:get(selfId, 'TCPPort');\n\n---fibaro:setGlobal(\"EvohomeAPI\", \"mode,HeatingOff,\"..locationID..\",,,\")\n---fibaro:sleep(2000)\nfibaro:startScene(sceneID, {\"mode\",\"HeatingOff\",locationID,\"\",\"\",\"\"})","buttonIcon":1005,"favourite":false,"main":false},{"id":7,"lua":true,"waitForResponse":false,"caption":"Custom","name":"btnQACustom","empty":false,"msg":"local selfId = fibaro:getSelfId();\nlocal locationID = fibaro:get(selfId, 'IPAddress');\nlocal sceneID = fibaro:get(selfId, 'TCPPort');\n\n---fibaro:setGlobal(\"EvohomeAPI\", \"mode,Custom,\"..locationID..\",,,\")\n---fibaro:sleep(2000)\nfibaro:startScene(sceneID, {\"mode\",\"Custom\",locationID,\"\",\"\",\"\"})","buttonIcon":1003,"favourite":false,"main":false}]},{"type":"label","elements":[{"id":8,"lua":false,"waitForResponse":false,"caption":"","name":"lblOverview","favourite":false,"main":false}]},{"type":"button","elements":[{"id":9,"lua":true,"waitForResponse":false,"caption":"Update","name":"btnUpdate","empty":false,"msg":"local selfId = fibaro:getSelfId();\nlocal locationID = fibaro:get(selfId, 'IPAddress');\nlocal sceneID = fibaro:get(selfId, 'TCPPort');\nlocal modes = {\"Auto\",\"Eco\",\"Away\",\"DayOff\",\"HeatingOff\",\"Custom\"}; -- do not change\nlocal icons = {1001,1006,1002,1004,1005,1003}; -- use the numbers of the icons\n\n---if fibaro:getGlobalValue(\"EvohomeAPI\") == \"0\" then\nif tonumber(fibaro:countScenes(tonumber(sceneID))) == 0 then\n  fibaro:log(\"Connecting...\");\n  ---fibaro:setGlobal(\"EvohomeAPI\", \"update,,\"..locationID..\",,,\")\n  ---fibaro:sleep(2000)\n  fibaro:debug(\"Updating\")\n  fibaro:startScene(sceneID, {\"update\",\"\",locationID,\"\",\"\",\"\"})\nelse\n  fibaro:debug(\"Scene already running, skipping this time.\")\nend\n\nfibaro:sleep(5000)\nfor i = 1, #modes do\n  if fibaro:getValue(selfId, \"ui.lblQuickActions.value\") == modes[i] then\n    icon = icons[i]\n  end\nend\nfibaro:call(selfId, \"setProperty\", \"currentIcon\", icon)","buttonIcon":1016,"favourite":false,"main":true}]},{"type":"label","elements":[{"id":10,"lua":false,"waitForResponse":false,"caption":"","name":"lbllastUpdate","favourite":false,"main":false}]},{"type":"label","elements":[{"id":11,"lua":false,"waitForResponse":false,"caption":"","name":"lblError","favourite":false,"main":false}]},{"type":"label","elements":[{"id":12,"lua":false,"waitForResponse":false,"caption":"Status","name":"lblStatus","favourite":false,"main":false}]}]},"actions":{"pressButton":1,"setSlider":2,"setProperty":2}}